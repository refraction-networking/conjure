
## Conjure configuration file
# -- This file currently operates as a manually tuned configuration for systemd. In
#    the future this may be automatically generated by a configuration script that
#    takes into account things like Tapdance presence, zbalance version and build. 

# indicates to start_zbalance_ipc.sh to create two sets of queues. Used for
# running two conjure stations or a conjure station together with tapdance.
# Only options right now are 1 and anything else (which runs 2 queue sets).
N_QUEUE_SETS=1

# The Zbalance_ipc cluster id that conjure will connect to 
CJ_CLUSTER_ID=98

# The fisrt core to stand up a detector on, 1 set here to give single zbalance thread its own core
CJ_COREBASE=0

# number of cores to launch detector threads on (increments from $CJ_COREBASE)
CJ_CORECOUNT=4

# Specify a core numerically to avoid.
CJ_SKIP_CORE=

# Interval for detector metrics logging 
CJ_LOG_INTERVAL=5

# private key used by the detectors 
CJ_PRIVKEY=/opt/conjure/sysconfig/privkey

# if running on a host where we need to connect to zbalance queues starting at a non-zero index 
#    specify that index here. queue attachment will happen incrementally from this index up to 
#    the value specified in $CJ_CORECOUNT.
CJ_QUEUE_OFFSET=0

 
# Path to the configuration file for the application and proxying portions of
# the station. Used by the conjure-app service
CJ_STATION_CONFIG=/opt/conjure/application/config.toml

# Path to the configuration file for the registration api. Used by the conjure-reg service
CJ_REGISTRAR_CONFIG=/opt/conjure/cmd/registration-server/config.toml

# Path to the configuration file containing phantom subnets. used primarily by
# the conjure-app service to figure out what subnets to choose from for new
# registrations.
PHANTOM_SUBNET_LOCATION=/opt/conjure/sysconfig/phantom_subnets.toml

# Allow the station to log client IPs (default disabled)
LOG_CLIENT_IP=false

# TODO add to per-station configs
CJ_IFACE="zc:enp179s0f0,zc:enp179s0f1"


# 1 - IP hash
# 7 - ERSPAN hash (custom; for rockypika)
ZBALANCE_HASH_MODE=1
ZBALANCE_CORE=1

# This is a hack to allow us to parse GRE/ERSPAN on some stations.
# Normal tap stations will set this to 0, but GRE-tap stations will
# set this to the number of bytes the Ether+IP+GRE headers are for
# that instance (e.g. ERSPAN on rockypika should be 42)
PARSE_GRE_OFFSET=0


CJ_PATH=/opt/conjure/

# ========================================================== #
# Local Network settings SET THESE FOR EACH DIFFERENT STATION

# IPv4 address of non-tap local interface
IP4_ADDR="127.0.0.1"

# IPv6 address of non-tap local interface.
IP6_ADDR="[::1]"

# tun interface offset (used when running multiple station on the same machine)
OFFSET=0


# Read local configs to allow for override of any of these settings
if [ -r /var/lib/conjure/conjure.conf ]; then
    echo "Applying local configs from /var/lib/conjure/conjure.conf"
    . /var/lib/conjure/conjure.conf
fi
